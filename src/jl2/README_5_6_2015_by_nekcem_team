

05/06/2015: 

=====================
  Descriptions:
=====================

This directory (src/jl2) includes a newly tuned gather-scatter routine updated by 
Matthew Otten (at Cornell), using the similar idea of OpenACC gather-scatter kernel 
previously done by Aaron Vose (Cray Inc) and Matthew Otten in this paper: 
       http://www.mcs.anl.gov/~mmin/hack_nekcem.pdf (pp.7, say version 15.0)

This newer version (src/jl2), say 15.1, has the following features:

      1. Keeps the same structure of James Lottes' original gs-routines;
      2. Uses new map arrays (for effective use of vectorization/streaming on GPU);
      3. Gives similar levels of performance on the CPU.

=====================
  How to use it:
=====================

To test with our newly tuned gather-scatter kernel: there would be nothing 
to change in the source code. You simply change our makefile to compile with src/jl2 
(instead of the current src/jl).

For OpenACC GPU runs w/  GPUDirect: require "-DGPUDIRECT" option at compile time. 
For OpenACC GPU runs w/o GPUDirect: no additional option required.
For CPU-only runs                 : no additional option required. 

=====================
  Difference:
=====================
The only difference between (src/jl) vs. (src/jl2) is the following files:
     src/jl2/gs.c
     src/jl2/gs_local.c
     src/jl2/gs_local.h
     src/jl2/comm.c


=====================
  Tests Done on 5/6/2015:
=====================

  Nek5000: 
        1. CPU-only runs tested on OLCF Titan with Cray & PGI compilers
        2. CPU-only runs tested on local machines with PGI compiler

        3. GPU runs w/  GPUDirect: warning message at runtime (some variables in bdry.f)
           

  NekCEM: 
        1. CPU-only runs tested on OLCF Titan with Cray & PGI compilers
        2. CPU-only runs tested on local machines with PGI compiler

        * It should work good for GPU runs if openacc_pragma_related_bugs are fixed in the compilers.

          The compiler issues will apply for Nek5000 too; will update you once the compiler issues
          are all resolved.
          -- pairwise works for GPUDirect or GPUDirect-disabled 
          -- all-reduced does not for GPUDirect or GPUDirect-disabled (due to the compiler issue)
          -- crystal-router does not for GPUDirect or GPUDirect-disabled (due to the compiler issue)

        3. GPU runs w/  GPUDirect: pairwise tested with PGI compiler (on OLCF/Titan and Argonne/Maud).
        4. GPU runs w/  GPUDirect: bug report done for Cray compiler.
        5. GPU runs w/o GPUDirect: bug report done for PGI compiler.
        6. GPU runs w/o GPUDirect: bug report done for Cray compiler.
=====================
